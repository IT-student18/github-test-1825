<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<style>
html {	
    	width:100%;
    	height:100%;
	background-color: dimgrey;
}
body { 
    margin: auto;
    position: relative;
    padding: auto;
    text-wrap: wrap;
    width: 80vw;
}

body * {
	width: fit-content;
	margin: auto;
}
#MainCirc {
	position:absolute;
	font-size:10vh;
	left:50%;
	transform: translate(-50%, 0%);
}

#smallCirc {
	position:absolute;
	font-size:10vh;
	left:50%;
	transform: translate(-50%, 0%);
	/*background-color: white;*/
}
</style>
</head>

<body class="mt">
<br>
<h2 id="o1">noneYet</h2>
<svg width="58" height="58" id="MainCirc">
  <circle cx="29" cy="29" r="28" stroke="black" stroke-width="2" fill="green" />
</svg>

<svg width="52" height="52" class="RedCirc">
  <text> </text>
  <circle cx="26" cy="26" r="25" stroke="black" stroke-width="2" fill="red" />
</svg>

<svg width="52" height="52" id="smallCirc">
  <circle cx="26" cy="26" r="3" fill="blue"/>
</svg>

<script type="module" >
Math.random();
let a = [0, 0];
let b = [...a];
let d = 99999, r;
let intervalId = Array(3).fill(null);
const vWid = window.innerWidth;
const vHei = window.innerHeight;
const isAndroid = /(android)/i.test(navigator.userAgent);

const q = document.getElementById('MainCirc');
const out1 = document.getElementById('o1');
const Reds = [];
r = document.getElementById('smallCirc');
let n = 4;
for (let i = 0; i<n; i++){
    var clonedElement = document.getElementsByClassName('RedCirc')[0].cloneNode(true);
    document.body.appendChild(clonedElement);
}
[...document.getElementsByClassName('RedCirc')].forEach(element => {
    Reds.push(element);
});
Reds.forEach(element => {
    element.style.position = 'absolute';
    element.style.left = `${rdint(0, vWid)}px`;
    element.style.top = `${rdint(90, vHei)}px`;
});
r.style.position = 'absolute';
if (isAndroid) {
  document.addEventListener("touchmove", moveOnInteract);
  document.addEventListener("touchstart", moveOnInteract);
} else {
  document.addEventListener("mousemove", moveOnInteract);
  document.addEventListener("click", moveOnInteract);
}

intervalId[0] = setInterval(colDetect, 1);

function rdint(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function colDetect(){
    out1.innerHTML = `Page: (${a[0].toFixed(2)},${a[1].toFixed(2)})`;
    var isCol = false;
    Reds.forEach(element => {
        b = [parseFloat(element.style.left) + element.width.baseVal.value/2, parseFloat(element.style.top)];
        d = dist(a,b);
        element.querySelector('text').textContent = d;
        var rsum = element.querySelector('circle').r.baseVal.value + q.querySelector('circle').r.baseVal.value;
        // if (d <= rsum) {
        //   q.querySelector('circle').setAttribute('fill', 'yellow');
        //   /*element.style.left = `${rdint(0, vWid)}px`;
        //   element.style.top = `${rdint(90, vHei)}px`*/} else {
        //   q.querySelector('circle').setAttribute('fill', 'green');}
        if (d<=rsum) {out1.innerHTML += ' | ' + '<i style="color:green">!!!<i>';
        } else out1.innerHTML += ' | ' + d.toFixed(2).toString();
        });
        if (out1.innerHTML.slice(out1.innerHTML.indexOf('|') + 1).split('|').includes('!!!')) {
          console.log("!!!");
        }s
        r.style.left = b[0].toString() + 'px';
        r.style.top = b[1].toString() + 'px';
        if (isCol) {q.querySelector('circle').setAttribute('fill', 'yellow'); console.log("works, but doesn't");}
        console.log(isCol);
}

function dist([x1,y1],[x2,y2]){
    return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
}

function moveOnInteract(e) {
    e.preventDefault();
    if (isAndroid) {
    a[0] = e.touches[0].pageX - q.width.baseVal.value/2;
    a[1] = e.touches[0].pageY - q.height.baseVal.value/2;
    } else {
        a[0] = e.pageX;
        a[1] = e.pageY;
        out1.innerHTML = `Page: (${a[0].toFixed(2)},${a[1].toFixed(2)}), d=${d}`;
    }
    q.style.left = `${a[0]}px`;
    q.style.top = `${a[1]}px`;
}

function moveCircs(){
  const arrOfElts = document.getElementsByClassName('atacker');
  Array.from(arrOfElts).forEach(element => {
    const wid1 = element.width.baseVal.value;
    const lef = parseFloat(getComputedStyle(element).left);
    element.style.left = `${lef - 3}px`;
    if (lef<= -wid1) element.style.left = `${vWid - wid1}px`;
  });
}


</script>

</body>
<!-- src="myScript.js"m-->
</html>
